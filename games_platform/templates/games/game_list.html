{% extends 'base.html' %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä{% endblock %}

{% block content %}
<div class="games-header">
    <h1>–ö–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä</h1>
    
    <div class="games-controls">
        <!-- –ü–æ–∏—Å–∫ -->
        <form method="get" class="search-form">
            <input type="text"
                   name="search"
                   placeholder="–ü–æ–∏—Å–∫ –∏–≥—Ä..."
                   value="{{ search_query }}"
                   class="search-input">
            <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>

            {% if search_query %}
                <a href="{% url 'game_list' %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
            {% endif %}
        </form>

        <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
        <div class="sort-options">
            <span>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</span>
            <a href="?sort=newest{% if search_query %}&search={{ search_query }}{% endif %}"
               class="sort-option {% if sort_by == 'newest' %}active{% endif %}">
                –ù–æ–≤—ã–µ
            </a>
            <a href="?sort=popular{% if search_query %}&search={{ search_query }}{% endif %}"
               class="sort-option {% if sort_by == 'popular' %}active{% endif %}">
                –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ
            </a>
            <a href="?sort=rating{% if search_query %}&search={{ search_query }}{% endif %}"
               class="sort-option {% if sort_by == 'rating' %}active{% endif %}">
                –ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É
            </a>
        </div>

        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div class="games-actions">
            {% if user.is_authenticated and user.is_developer %}
                <a href="{% url 'game_create' %}" class="btn btn-success">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É</a>
            {% endif %}

            {% if user.is_authenticated and user.is_admin %}
                <a href="{% url 'moderation_list' %}" class="btn btn-warning">
                    –ú–æ–¥–µ—Ä–∞—Ü–∏—è ({{ pending_games_count }})
                </a>
            {% endif %}
        </div>
    </div>
</div>

<div class="games-grid">
    {% for game in games %}
    <div class="game-card">
        {% if game.thumbnail %}
        <img src="{{ game.thumbnail.url }}" alt="{{ game.title }}" class="game-thumbnail">
        {% else %}
        <div class="game-thumbnail-placeholder">–ù–µ—Ç –ø—Ä–µ–≤—å—é</div>
        {% endif %}

        <div class="game-info">
            <h3>{{ game.title }}</h3>
            <p class="game-developer">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: {{ game.developer.username }}</p>

            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≥—Ä—ã -->
            <div class="game-stats-small">
                <span class="stat">
                    <i class="stat-icon">üëÅÔ∏è</i> {{ game.get_view_count }}
                </span>
                <span class="stat">
                    <i class="stat-icon">üéÆ</i> {{ game.get_play_count }}
                </span>

                {% if game.get_average_rating > 0 %}
                <span class="stat rating-stat">
                    <i class="stat-icon">‚≠ê</i> {{ game.get_average_rating }}
                </span>
                {% endif %}
            </div>

            <p class="game-description">{{ game.description|truncatechars:100 }}</p>

            <div class="game-status status-{{ game.status }}">
                {{ game.get_status_display }}
            </div>

            <div class="game-actions">
                <a href="{% url 'game_detail' game.pk %}" class="btn btn-primary">
                    {% if game.status == 'approved' %}–ò–≥—Ä–∞—Ç—å{% else %}–ü–æ–¥—Ä–æ–±–Ω–µ–µ{% endif %}
                </a>

                {% if user.is_authenticated %}
                    {% if game.can_edit %}
                        <a href="{% url 'game_edit' game.pk %}" class="btn btn-secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="no-games">
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–≥—Ä. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç –∏–≥—Ä—É!</p>
        {% if user.is_authenticated and user.is_developer %}
            <a href="{% url 'game_create' %}" class="btn btn-success">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—É—é –∏–≥—Ä—É</a>
        {% endif %}
    </div>
    {% endfor %}
</div>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
{% if games.has_other_pages %}
<div class="pagination">
    <div class="pagination-info">
        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ games.number }} –∏–∑ {{ games.paginator.num_pages }}
    </div>

    <div class="pagination-links">
        {% if games.has_previous %}
            <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by != 'newest' %}&sort={{ sort_by }}{% endif %}"
               class="pagination-link">¬´ –ü–µ—Ä–≤–∞—è</a>
            <a href="?page={{ games.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by != 'newest' %}&sort={{ sort_by }}{% endif %}"
               class="pagination-link">‚Äπ –ù–∞–∑–∞–¥</a>
        {% endif %}

        {% for num in games.paginator.page_range %}
            {% if games.number == num %}
                <span class="pagination-link active">{{ num }}</span>
            {% elif num > games.number|add:'-3' and num < games.number|add:'3' %}
                <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by != 'newest' %}&sort={{ sort_by }}{% endif %}"
                   class="pagination-link">{{ num }}</a>
            {% endif %}
        {% endfor %}

        {% if games.has_next %}
            <a href="?page={{ games.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by != 'newest' %}&sort={{ sort_by }}{% endif %}"
               class="pagination-link">–í–ø–µ—Ä–µ–¥ ‚Ä∫</a>
            <a href="?page={{ games.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if sort_by != 'newest' %}&sort={{ sort_by }}{% endif %}"
               class="pagination-link">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}